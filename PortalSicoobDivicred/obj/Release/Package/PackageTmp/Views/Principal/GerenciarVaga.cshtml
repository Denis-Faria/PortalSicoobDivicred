<script src='@Url.Content("~/Assets/js/jquery-ui.min.js")' type="text/javascript"></script>
<script src='@Url.Content("~/Assets/js/jquery.tablesorter.min.js")' type="text/javascript"></script>
<link href="@Url.Content("~/Assets/css/animate.css")" rel="stylesheet" />
<script type="text/javascript" src="@Url.Content("~/Assets/js/iziToast.min.js")"></script>
<link href="@Url.Content("~/Assets/css/iziToast.min.css")" rel="stylesheet" />

<script>

    function LinhaSeleciona() {
            $('#TabelaCurriculo').find('tr').each(function () {
                var row = $(this);
                if (row.find('input[type="checkbox"]').is(':checked')) {
                    row.addClass("is-selected");
                } else {
                    row.removeClass("is-selected");
                }

            });

    }


    function Curriculo() {
        $("#Conteudo").empty();
        $.ajax(
            {
                type: 'GET',
                dataType: 'html',
                url: '/Principal/Curriculo',
                cache: true,
                async: true,
                data: { "Ordenacao": "" },
                success: function(data) {
                    $("#Conteudo").append(data);


                }
            });

    }

    function Encerrar(Id) {
        var IdVaga = Id;
        var form = $("#Curriculos").serialize();
        iziToast.show({
            title: 'Processo seletivo.',
            message: 'Você tem certeza que todas as informações estão corretas e deseja encerrar este processo seletivo ?',
            position: 'center',
            progressBarColor: 'rgb(0, 255, 184)',
            buttons: [
                [
                    '<button>Sim</button>', function (instance, toast) {
                        alert("Ola");

                        $("#FormEncerraPRocesso").submit();

                        }

                ],
                [
                    '<button>Não</button>', function (instance, toast) {
                        instance.hide({
                            transitionOut: 'fadeOutUp',
                            onClosing: function (instance, toast, closedBy) {
                                console.info('closedBy: ' + closedBy); //btn2
                            }
                        },
                            toast,
                            'close',
                            'btn2');
                    }
                ]
            ],
            onOpening: function (instance, toast) {
                console.info('callback abriu!');
            },
            onClosing: function (instance, toast, closedBy) {
                console.info('closedBy: ' + closedBy); // tells if it was closed by 'drag' or 'button'
            }
        });



    }
    function VerPerfil(Cpf) {
        $("#PerfilCompleto").empty();
        $.ajax(
            {
                type: 'GET',
                url: '/Principal/PerfilCandidato',
                dataType: 'html',
                cache: true,
                async: true,
                data: { "Cpf": Cpf },
                success: function(data) {
                    $("#PerfilCompleto").append(data);
                    $('#ModalPerfil').removeClass();
                    $('#ModalPerfil').addClass('modal is-active');


                }
            });
    }

    function EncerrarProcesso(IdVaga) {
        $("#ProcessoCompleto").empty();
        $.ajax(
            {
                type: 'GET',
                url: '/Principal/PerfilCandidatoProcesso',
                dataType: 'html',
                cache: true,
                async: true,
                data: { "IdVaga": IdVaga },
                success: function (data) {
                    $("#ProcessoCompleto").append(data);
                    $('#ModalEncerramento').removeClass();
                    $('#ModalEncerramento').addClass('modal is-active');


                }
            });
    }

    function ResultadoProcesso(IdVaga) {
        $("#ResultadoCompleto").empty();
        $.ajax(
            {
                type: 'GET',
                url: '/Principal/ResultadoProcesso',
                dataType: 'html',
                cache: true,
                async: true,
                data: { "IdVaga": IdVaga },
                success: function (data) {
                    $("#ResultadoCompleto").append(data);
                    $('#ModalResultado').removeClass();
                    $('#ModalResultado').addClass('modal is-active');


                }
            });
    }

    $("#FiltroPerfil").submit(function() {
        $.ajax({
            type: "POST",
            url: "/Principal/FiltrarPerfilVaga",
            data: $("#FiltroPerfil").serialize(),
            success: function(data) {
                $("#Conteudo").empty();
                $("#Conteudo").append(data);
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                alert("epic fail!");
            }
        });
        return false;
    });

    function Dash() {
        $("#Conteudo").empty();
        $.ajax(
            {
                type: 'GET',
                dataType: 'html',
                cache: true,
                async: true,
                success: function(data) {
                    $.get('/Principal/Dashboard',
                        function(data) {
                            $("#Conteudo").append(data);

                        });
                }
            });

    }

    $(document).ready(function() {
        window.history.pushState("state", "title", "/Principal/Principal");

    });

    $(function() {
        $("#TabelaCurriculo").tablesorter();
    });

    function AbrirProcesso(Id) {
        var IdVaga = Id;
        var form = $("#Curriculos").serialize();
        iziToast.show({
            title: 'Processo seletivo.',
            message: 'Você tem certeza que deseja abrir um processo seletivo com os curriculos filtrados ?',
            position: 'center',
            progressBarColor: 'rgb(0, 255, 184)',
            buttons: [
                [
                    '<button>Sim</button>', function(instance, toast) {
                        var count = 0;
                        $('#TabelaCurriculo').find('tr').each(function () {
                            var row = $(this);
                            if (row.find('input[type="checkbox"]').is(':checked')) {
                                count++;
                            }
                        });
                        if (count == 0) {
                            instance.hide({
                                    transitionOut: 'fadeOutUp',
                                    onClosing: function(instance, toast, closedBy) {
                                        console.info('closedBy: ' + closedBy); //btn2
                                    }
                                },
                                toast,
                                'close',
                                'btn2');
                            iziToast.error({
                                title: 'Error',
                                message: 'Favor selecionar os curriculos que participaram do processo seletivo',
                                position: 'center'
                            });
                        }
                        else{
                            $("#FormCurriculo").submit();
                            }

                    }
                ],
                [
                    '<button>Não</button>', function(instance, toast) {
                        instance.hide({
                                transitionOut: 'fadeOutUp',
                                onClosing: function(instance, toast, closedBy) {
                                    console.info('closedBy: ' + closedBy); //btn2
                                }
                            },
                            toast,
                            'close',
                            'btn2');
                    }
                ]
            ],
            onOpening: function(instance, toast) {
                console.info('callback abriu!');
            },
            onClosing: function(instance, toast, closedBy) {
                console.info('closedBy: ' + closedBy); // tells if it was closed by 'drag' or 'button'
            }
        });
    }

</script>


<nav class="breadcrumb" aria-label="breadcrumbs">
    <ul>
        <li>
            <a href="javascript:Dash()">
                <span class="icon is-small">
                    <i class="fa fa-home"></i>
                </span><span>DashBoard</span>
            </a>
        </li>
        <li>
            <a href="javascript:Curriculo()">
                <span class="icon is-small">
                    <i class="fa fa-book"></i>
                </span><span>Curriculos</span>
            </a>
        </li>
        <li class="is-active">
            <a href="#" aria-current="page" style="color: #38d5c5;">
                <span class="icon is-small" style="color: #38d5c5;">
                    <i class="fa fa-suitcase" aria-hidden="true"></i>
                </span><span>Vagas - @TempData["TituloVaga"]</span>
            </a>
        </li>
    </ul>
</nav>
<div>
    <form id="FiltroPerfil" name="FiltroPerfil">
        <span>
            <h2 class="subtitle">@TempData["TituloVaga"]</h2>
        </span>
        <input id="TituloVaga" name="TituloVaga" value="@TempData["TituloVaga"]" hidden="true" />
        <br />
        <div class="field is-grouped">

            <p class="control has-icons-left">
                <span class="select">
                    <select name="FiltroSexo" id="FiltroSexo">
                        <option selected>Sexo</option>
                        <option>Masculino</option>
                        <option>Feminino</option>
                    </select>
                </span>
                <span class="icon is-small is-left">
                    <i class="fa fa-venus-mars" aria-hidden="true"></i>
                </span>
            </p>
            <div class="field">
                <p class="control has-icons-left">
                    <input name="FiltroCidade" id="FiltroCidade" class="input input-search" type="text" placeholder="Cidade">
                    <span class="icon is-small is-left">
                        <i class="fa fa-bank"></i>
                    </span>
                </p>
            </div>
            <p class="control has-icons-left">
                <span class="select">
                    <select id="FiltroGraduacao" name="FiltroGraduacao">
                        <option selected>Graduação</option>
                        <option>Ensino médio | Andamento/Completo</option>
                        <option>Superior | Andamento/Completo </option>
                        <option>Pós-Graduação | Andamento/Completo</option>
                        <option>Mestrado/Doutorado | Andamento/Completo</option>
                    </select>
                </span>
                <span class="icon is-small is-left">
                    <i class="fa fa-graduation-cap" aria-hidden="true"></i>
                </span>
            </p>

            <div class="field">
                <p class="control has-icons-left">
                    <input id="FiltroAnoFormacao" name="FiltroAnoFormacao" class="input" type="text" placeholder="Ano de Formação">
                    <span class="icon is-small is-left">
                        <i class="fa fa-calendar-o"></i>
                    </span>
                </p>
            </div>

            <p class="control has-icons-left">
                <span class="select">
                    <select id="FiltroFaixaEtaria" name="FiltroFaixaEtaria">
                        <option selected>Faixa Etária</option>
                        <option> < 18 </option>
                        <option>18 - 25 </option>
                        <option>25 - 30 </option>
                        <option>30 - 40 </option>
                        <option> 40 > </option>
                    </select>
                </span>
                <span class="icon is-small is-left">
                    <i class="fa fa-birthday-cake" aria-hidden="true"></i>
                </span>
            </p>


            <div class="field">
                <p class="control has-icons-left">
                    <input id="FiltroCertificacao" name="FiltroCertificacao" class="input" type="text" placeholder="Certificação">
                    <span class="icon is-small is-left">
                        <i class="fa fa-certificate"></i>
                    </span>
                </p>
            </div>

        </div>
        <!--
        Parte Superior com tabela
        -->
        <p class="field">
            <button type="submit" class="button is-success" data-balloon="Clique para filtrar os perfis para esta vaga" data-balloon-pos="down" id="Filtro" name="Filtro" onmouseleave="$('#Filtro').removeClass('animated pulse')" onmouseover="$('#Filtro').addClass('animated pulse');">
                <span class="icon is-small">
                    <i class="fa fa-filter" aria-hidden="true"></i>
                </span>
                <span>Aplicar Filtro</span>
            </button>

            <a type="button" @TempData["ProcessoAtivo"] href="javascript:AbrirProcesso();" name="AbrirProcesso" id="AbrirProcesso" onmouseleave="$('#AbrirProcesso').removeClass('animated pulse')" onmouseover="$('#AbrirProcesso').addClass('animated pulse');" class="button is-success" data-balloon="@TempData["DicaProcesso"]" data-balloon-pos="down">
                <span class="icon is-small">
                    <i class="fa fa-bolt" aria-hidden="true"> </i>
                </span> <span>Iniciar Processo Seletivo</span>
            </a>
            <a type="button" href="javascript:ResultadoProcesso(@TempData["IdVaga"]);" name="ResultadoProcesso" id="ResultadoProcesso" onmouseleave="$('#ResultadoProcesso').removeClass('animated pulse')" onmouseover="$('#ResultadoProcesso').addClass('animated pulse');" class="button is-success" data-balloon="Clique para ver o resultado do processo seletivo!" data-balloon-pos="down">
                <span class="icon is-small">
                    <i class="fa fa-check-square" aria-hidden="true"> </i>
                </span> <span>Ver Resultado</span>
            </a>
            <a @TempData["Ativa"] type="button" href="javascript:EncerrarProcesso('@TempData["IdVaga"]')" name="EncerrarProcesso" id="EncerrarProcesso" onmouseleave="$('#EncerrarProcesso').removeClass('animated pulse')" onmouseover="$('#EncerrarProcesso').addClass('animated pulse');" class="button is-danger" data-balloon="@TempData["DicaEncerramento"]" data-balloon-pos="down">
                <span class="icon is-small">
                    <i class="fa fa-exclamation-triangle" aria-hidden="true"> </i>
                </span><span> Encerrar Processo Seletivo</span>
            </a>
            <a @TempData["Ativa"] type="button" href='@Url.Action("EncerrarVaga", "Principal", new {IdVaga = TempData["IdVaga"]})' class="button is-danger" data-balloon="@TempData["Dica"]" data-balloon-pos="down" id="EncerrarVaga" name="EncerrarVaga" onmouseleave="$('#EncerrarVaga').removeClass('animated pulse')" onmouseover="$('#EncerrarVaga').addClass('animated pulse');">
                <span class="icon is-small">
                    <i class="fa fa-times fa-fw" aria-hidden="true"> </i>
                </span> <span>Encerrar Vaga</span>
            </a>
        </p>
        <hr />
    </form>
    <!--
    Parte Inferior com tabela
    -->
    <span>
        <h2 class="subtitle">@TempData["QuantidadeCurriculo"]</h2>
    </span>
    <br />
    @using (Html.BeginForm("AbrirProcesso", "Principal", FormMethod.Post, new { id = "FormCurriculo" }))
    {
        <input hidden="true" id="vaga" name="vaga" value="@TempData["IdVaga"]" />
        <table id="TabelaCurriculo" name="TabelaCurriculo" class="lista-curriculo table is-striped is-centered" style="text-align: center">
            <thead>
            <th></th>
            <th>Nome</th>
            <th>Email</th>
            <th>Cidade</th>
            <th>Certificação</th>
            </thead>
            <tbody>
                @for (var i = 0; i < Convert.ToInt32(TempData["TotalCurriculo"].ToString()); i++)
                {
                    <tr>
                        <td>
                            <label class="checkbox">
                                <input id="@TempData["Cpf" + i]" name="@TempData["Cpf" + i]" type="checkbox" onchange="LinhaSeleciona()">
                            </label>
                        </td>
                        <td>
                            <article class="media">
                                <div class="media-left grow pic">
                                    <figure class="image is-32x32">
                                        <img src="@TempData["Imagem" + i]" />
                                    </figure>
                                </div>
                                <div class="media-content">
                                    <div class="content">
                                        <p>
                                            <a href="javascript:VerPerfil('@TempData["Cpf" + i]')">@TempData["Nome" + i].ToString()</a> <strong></strong>
                                        </p>
                                    </div>
                                </div>
                            </article>
                        </td>
                        <td>@TempData["Email" + i].ToString()</td>
                        <td>@TempData["Cidade" + i].ToString()</td>
                        <td>@TempData["Certificacao" + i].ToString()</td>
                    </tr>
                }
            <tbody>
        </table>
    }



    <div id="ModalEncerramento" class="modal is-narrow">
        <div class="modal-background"></div>
        <div class="modal-card is-narrow" style="width: 1800px">
            <header class="modal-card-head">
                <p class="modal-card-title">Processo Seletivo</p>
                <a href="javascript:$('#ModalEncerramento').removeClass();$('#ModalEncerramento').addClass('modal');" class="delete"></a>
            </header>
            <section class="modal-card-body is-narrow">
                <div id="ProcessoCompleto">

                </div>

            </section>
            <footer class="modal-card-foot">
                <p class="field">
                    <button onclick="Encerrar(@TempData["IdVaga"])" type="submit" class="button is-success">
                        <span class="icon">
                            <i class="fa fa-comments-o"></i>
                        </span>
                        <span>Encerrar Processo Seletivo</span>
                    </button>

                    <a class="button" href="javascript:$('#ModalEncerramento').removeClass();$('#ModalEcerramento').addClass('modal');">Cancelar</a>
                </p>
            </footer>
        </div>

    </div>

    <!--

    Modal Perfil
    -->


    <div id="ModalPerfil" class="modal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Perfil</p>
                <a href="javascript:$('#ModalPerfil').removeClass();$('#ModalPerfil').addClass('modal');" class="delete"></a>
            </header>
            <section class="modal-card-body">
                <div id="PerfilCompleto">

                </div>


            </section>
            <footer class="modal-card-foot">
                <p class="field">
                    <button onclick="Imprimir()" type="submit" class="button is-success">
                        <span class="icon">
                            <i class="fa fa-print"></i>
                        </span>
                        <span>Imprimir</span>
                    </button>

                    <a class="button" href="javascript:$('#ModalPerfil').removeClass();$('#ModalPerfil').addClass('modal');">Cancelar</a>
                </p>
            </footer>
        </div>
    </div>

    <div id="ModalResultado" class="modal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <button class="delete" aria-label="close" onclick="javascript:$('#ModalResultado').removeClass();$('#ModalResultado').addClass('modal');"></button>
            </header>
            <section class="modal-card-body">
                <div>
                    <figure class=" image  is-128x128">
                        <img src="/Images/sucesso.png" />
                    </figure>
                </div>
                <div id="ResultadoCompleto">

                </div>
            </section>
        </div>
    </div>












